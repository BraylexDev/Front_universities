<!-- ranking-upload.component.html -->
<div class="row">
  <!-- Upload Form -->
  <div class="col-lg-6 mb-4">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-header bg-secondary bg-gradient text-white">
        <h5 class="mb-0">
          <i class="pi pi-cloud-upload me-2"></i>Upload Ranking
        </h5>
      </div>
      <div class="card-body">
        <form [formGroup]="uploadForm" (ngSubmit)="uploadFile()">
          <!-- AÃ±o Selection -->
          <div class="mb-3">
            <label for="year" class="form-label fw-semibold">
              <i class="pi pi-calendar me-2"></i>Ranking Year
            </label>
            <select
              class="form-select form-select-lg"
              [class.is-invalid]="isFieldInvalid('year')"
              id="year"
              formControlName="year"
            >
              <option value="">Select a year</option>
              <option *ngFor="let year of availableYears" [value]="year">
                {{ year }}
              </option>
            </select>
            <div class="invalid-feedback" *ngIf="isFieldInvalid('year')">
              Year is required
            </div>
          </div>
          <!-- File Upload Area -->
          <div class="mb-4">
            <label class="form-label fw-semibold">
              <i class="pi pi-paperclip me-2"></i>Ranking File
            </label>
            <div
              class="drag-area"
              [class.drag-over]="isDragOver"
              (dragover)="onDragOver($event)"
              (dragleave)="onDragLeave($event)"
              (drop)="onDrop($event)"
              onclick="document.getElementById('fileInput')?.click()"
            >
              <div *ngIf="!selectedFile" class="text-center">
                <i class="pi pi-cloud-upload display-1 text-success mb-3"></i>
                <h5>Drag your file here</h5>
                <p class="text-muted">or <strong>click</strong> to select</p>
                <small class="text-muted">
                  Supported formats: Excel (.xlsx)
                  <br />Maximum size: 10MB
                </small>
              </div>

              <div *ngIf="selectedFile" class="text-center">
                <i class="pi pi-file-excel text-success display-4 mb-2"></i>
                <h6 class="mb-1">{{ selectedFile.name }}</h6>
                <small class="text-muted">{{
                  formatFileSize(selectedFile.size)
                }}</small>
                <br />
                <button
                  type="button"
                  class="btn btn-outline-danger btn-sm mt-2"
                  (click)="selectedFile = null; $event.stopPropagation()"
                >
                  <i class="pi pi-times me-1"></i>Remove
                </button>
              </div>

              <input
                type="file"
                id="fileInput"
                class="d-none"
                accept=".xlsx,.xls,.csv"
                (change)="onFileSelected($event)"
              />
            </div>
          </div>

          <!-- Progress Bar -->
          <div *ngIf="isUploading" class="mb-3">
            <div class="d-flex justify-content-between align-items-center mb-1">
              <small class="text-muted">Uploading file...</small>
              <small class="text-muted">{{ uploadProgress }}%</small>
            </div>
            <div class="progress">
              <div
                class="progress-bar progress-bar-striped progress-bar-animated bg-success"
                [style.width.%]="uploadProgress"
              ></div>
            </div>
          </div>

          <!-- Messages -->
          <div class="alert alert-success" *ngIf="successMessage">
            <i class="pi pi-check-circle me-2"></i>{{ successMessage }}
          </div>

          <div class="alert alert-danger" *ngIf="errorMessage">
            <i class="pi pi-exclamation-triangle me-2"></i>{{ errorMessage }}
          </div>

          <!-- Actions -->
          <div class="d-grid gap-2 d-md-flex justify-content-md-end">
            <button
              type="button"
              class="btn btn-outline-secondary"
              (click)="resetForm()"
              [disabled]="isUploading"
            >
              <i class="pi pi-refresh me-2"></i>Clean
            </button>
            <button
              type="submit"
              class="btn btn-success"
              [disabled]="!selectedFile || uploadForm.invalid || isUploading"
            >
              <span
                *ngIf="isUploading"
                class="spinner-border spinner-border-sm me-2"
              ></span>
              <i *ngIf="!isUploading" class="pi pi-upload me-2"></i>
              {{ isUploading ? "uploading file..." : "Upload File" }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
